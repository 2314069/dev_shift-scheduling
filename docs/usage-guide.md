# シフトスケジューラー 使い方ガイド

## 起動方法

ターミナルを2つ開き、それぞれで以下を実行します。

**バックエンド（ターミナル1）:**

```bash
cd backend
uv run uvicorn backend.main:app --reload --port 8000
```

**フロントエンド（ターミナル2）:**

```bash
cd frontend
npm run dev
```

起動後、ブラウザで http://localhost:3000 にアクセスします。

---

## 基本的な流れ

```
1. 設定（スタッフ・シフト枠・必要人数を登録）
       ↓
2. スケジュール期間を作成
       ↓
3. スタッフが希望を入力
       ↓
4. 最適化を実行してシフト表を自動生成
       ↓
5. 必要に応じて手動で微調整
       ↓
6. シフト表を公開
```

---

## Step 1: 設定

画面上部のナビゲーションから **「設定」** をクリックします。

### スタッフの登録

1. 「スタッフ管理」セクションの **「追加」** ボタンをクリック
2. 以下の情報を入力:
   - **名前**: スタッフの氏名
   - **役割**: 「リーダー」「一般」など
   - **最大勤務日数/週**: 週あたりの上限（デフォルト: 5）
3. **「保存」** をクリック

登録済みスタッフは一覧に表示されます。**「編集」** で変更、**「削除」** で削除できます。

### シフト枠の登録

1. 「シフト枠管理」セクションの **「追加」** ボタンをクリック
2. 以下の情報を入力:
   - **シフト名**: 「早番」「遅番」「夜勤」など
   - **開始時間**: シフトの開始時刻（例: 09:00）
   - **終了時間**: シフトの終了時刻（例: 17:00）
3. **「保存」** をクリック

### 必要人数の設定

1. 「必要人数設定」セクションの **「追加」** ボタンをクリック
2. 以下の情報を入力:
   - **シフト枠**: 対象のシフト枠を選択
   - **日種別**: 「平日」または「休日」
   - **最低人数**: そのシフトに必要な最低人数
3. **「保存」** をクリック

> **例**: 早番は平日3人、休日2人必要な場合 → 2つのレコードを登録します。

---

## Step 2: スケジュール期間の作成

ナビゲーションから **「シフト表」** をクリックします。

1. **開始日** と **終了日** を入力（例: 2026-03-01 〜 2026-03-15）
2. **「期間を作成」** をクリック

作成された期間はドロップダウンに表示されます。ステータスは「下書き」になります。

---

## Step 3: スタッフの希望入力

ナビゲーションから **「希望入力」** をクリックします。

### スタッフの選択

初回アクセス時はスタッフ一覧が表示されます。自分の名前をクリックします。

> **URL直接アクセス**: `http://localhost:3000/staff?id=1` のようにスタッフIDを指定してアクセスすることもできます。

### 希望の入力

1. 対象の **スケジュール期間** を選択
2. カレンダー上の日付をクリック
3. 表示されるメニューから選択:
   - **「希望: 早番」** など → その日にそのシフトを希望（青で表示）
   - **「出勤不可」** → その日は出勤できない（赤で表示）
   - **「クリア」** → 入力を取り消し
4. すべての希望を入力したら **「希望を提出」** をクリック

### カレンダーの見方

| 色 | 意味 |
|---|---|
| 青 | 希望シフトあり |
| 赤 | 出勤不可 |
| 灰色 | 未入力 |

---

## Step 4: 最適化の実行

**「シフト表」** 画面に戻ります。

1. ドロップダウンから対象の期間を選択
2. **「最適化実行」** ボタンをクリック
3. 数秒待つと、シフト表が自動生成されます

### 最適化で考慮される条件

- 各シフト枠の **必要人数** を満たす
- スタッフの **出勤不可日** を厳守
- **連勤制限**（デフォルト: 6日連続まで）
- スタッフごとの **週あたり勤務上限**
- 1日に1つのシフトのみ割り当て

> **「実行可能なシフトが見つかりませんでした」** と表示された場合は、制約が厳しすぎます。スタッフを増やすか、必要人数を減らしてください。

---

## Step 5: 手動編集

最適化結果を確認し、必要に応じて手動で調整します。

1. シフト表のセルをクリック
2. ドロップダウンからシフト枠を変更、または「休み」を選択
3. 手動編集したセルは **オレンジの枠線** で区別されます

> 手動編集した割り当ては、再度最適化を実行しても保持されます。

---

## Step 6: シフト表の公開

調整が完了したら:

1. **「公開」** ボタンをクリック
2. ステータスが「公開済み」に変わります
3. スタッフは「希望入力」画面から公開されたシフト表を確認できます

> 公開後はシフト表の編集ができなくなります。

---

## シフト表の見方

| 表示 | 意味 |
|---|---|
| 色付きセル | シフト割り当てあり（色はシフト枠ごとに異なる） |
| オレンジ枠線 | 手動編集されたセル |
| グレー / `-` | 休み（割り当てなし） |
| 赤背景の列ヘッダー | 土日 |

---

## よくある使い方のパターン

### 月前半・後半で分けて管理

1. 3/1〜3/15 の期間を作成 → 最適化 → 公開
2. 3/16〜3/31 の期間を作成 → 最適化 → 公開

### 最適化結果が気に入らない場合

1. 手動でセルを修正
2. または条件（必要人数・スタッフ数）を変更して再度最適化

### スタッフを追加した場合

設定画面でスタッフを追加した後、最適化を再実行すると新しいスタッフも含めて再計算されます。
